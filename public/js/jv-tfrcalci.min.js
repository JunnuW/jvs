var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.findInternal=function(d,g,f){d instanceof String&&(d=String(d));for(var e=d.length,h=0;h<e;h++){var k=d[h];if(g.call(f,k,h,d))return{i:h,v:k}}return{i:-1,v:void 0}};$jscomp.defineProperty="function"==typeof Object.defineProperties?Object.defineProperty:function(d,g,f){if(f.get||f.set)throw new TypeError("ES3 does not support getters and setters.");d!=Array.prototype&&d!=Object.prototype&&(d[g]=f.value)};
$jscomp.getGlobal=function(d){return"undefined"!=typeof window&&window===d?d:"undefined"!=typeof global&&null!=global?global:d};$jscomp.global=$jscomp.getGlobal(this);$jscomp.polyfill=function(d,g,f,e){if(g){f=$jscomp.global;d=d.split(".");for(e=0;e<d.length-1;e++){var h=d[e];h in f||(f[h]={});f=f[h]}d=d[d.length-1];e=f[d];g=g(e);g!=e&&null!=g&&$jscomp.defineProperty(f,d,{configurable:!0,writable:!0,value:g})}};
$jscomp.polyfill("Array.prototype.find",function(d){return d?d:function(d,f){return $jscomp.findInternal(this,d,f).v}},"es6-impl","es3");
var dirUser="Publ",DFmngo,matrlArr=[],matrlStr="nm\tn\tk\r\n500\t1.0\t0.0\r\n510\t1.5\t0.2\r\n520\t1.2\t0.4",oMatOptTable={},oMatTable={},oStackTable={},oTargOptTable={},otargTable={},selctdNde={},spArra=[,,],spNum=201,stack={},stackArr=[["Cover","DblClick to edit!","bulk","no",[]],["Substr.","DblClick to edit!","bulk","no",[]]],userName="No login",targArr=[],targStr="nm\tR\t'sample data'\r\n500\t55.0\r\n510\t54.0\r\n520\t55.0";
$(function(){function d(a){return a.$("tr.row_selected")}function g(a){return a.toString().match(/^\d*\.?[0-9]+([eE][-][0-9]+)?$/)&&a?!0:!1}function f(a){var b=a.slice(0,1);a=a.slice(1);a.sort(function(a,b){return a[0]-b[0]});return b.concat(a)}window.onbeforeunload=function(){return"Unsaved data?"};stack=buildStack();DFmngo=$("#mongoDialForm");DFmngo.dialog("option","title","Open stack file from");window.sessionStorage.getItem("RTFtoken")&&0<window.sessionStorage.getItem("RTFtoken").length?userName=
window.sessionStorage.getItem("RTFuser"):(userName="No login",dirUser="Publ",mongoGetOne("Defaults/R-Default",dirUser));targArr=splitToArr(targStr);matrlArr=splitToArr(matrlStr);$("#tabis").tabs({heightStyle:"auto",activate:function(a,b){var c=b.oldTab.index();if("Settings"==$("#tabis").find("ul>li a").eq(c).attr("id")){stack.settings.polaris=$('input[name="polSel"]:checked').val();stack.settings.angle=parseFloat($("#incAng").spinner("value"));stack.settings.RorT=$('input[name="setCalcfor"]:checked').val();
stack.settings.backR=$("#bottomR").is(":checked");stack.settings.frontR=$("#frontR").is(":checked");stack.settings.SubstrD=parseFloat(1E3*$("#sThickn").spinner("value"));stack.settings.CoverD=parseFloat(1E3*$("#cThickn").spinner("value"));stack.settings.spUnit=$('input[name="setUnit"]:checked').val();switch(stack.settings.spUnit){case "nm":stack.settings.spStart=$("#SpStart").spinner("value");stack.settings.spStop=$("#SpStop").spinner("value");break;case "um":c=1E3*$("#SpStart").spinner("value");
stack.settings.spStart=c.toFixed(3);c=1E3*$("#SpStop").spinner("value");stack.settings.spStop=c.toFixed(3);break;case "eV":stack.settings.spStart=(1239.842/$("#SpStart").spinner("value")).toFixed(4),stack.settings.spStop=(1239.842/$("#SpStop").spinner("value")).toFixed(4)}buildSpArray();updNKspArra();updTargSpArra();updRTspArra();updGraph()}c=b.newTab.index();c=$("#tabis").find("ul>li a").eq(c).attr("id");"Targets"==c&&(plotRT(targArr,7),$("#targEditTabl").find("th:eq(0)").text("Wavel. ["+targArr[0][0]+
"]").find("th:eq(1)").text(targArr[0][1]+" %-value"));"Materials"==c&&plotNK(matrlArr,8);"Settings"==c&&(userName=window.sessionStorage.getItem("RTFtoken")&&0<window.sessionStorage.getItem("RTFtoken").length?window.sessionStorage.getItem("RTFuser"):"No login",$("#UserName").text(userName));"Stack"==c&&updGraph()}});$.extend($.fn.DataTable.defaults,{bPaginate:!0,bLengthChange:!0,bFilter:!0,bSort:!1,bInfo:!0,bAutoWidth:!0});$('input[name="setCalcfor"]').change(function(){"R"==this.value?($("#setTarg").text("Calculated  reflectance includes:"),
$("#CalcRes").text("Reflectance is graphed on "+stack.settings.spUnit+" axis"),$("#targMode").text("Target spectrum for reflectance"),$("#targCol2").text("R%-value"),$("#StackRTb").text("Stack Reflectance")):($("#setTarg").text("Calculated  transmittance includes:"),$("#CalcRes").text("Transmittance is graphed on "+stack.settings.spUnit+" axis"),$("#targMode").text("Target spectrum for transmittance"),$("#targCol2").text("T%-value"),$("#StackRTb").text("Stack Transmittance"))});$("#obliDiv").hide();
var e=$("#bottomR");e.attr("checked",!1);var h=$("#frontR");h.attr("checked",!1);e.click(function(){$('input[name="setCalcfor"]:checked').val();h.attr("checked",!1);$(this).is(":checked")});h.click(function(){$(this).is(":checked")&&(e.attr("checked",!1),$(this).is(":checked"))});$('input[name="incidenceA"]').change(function(){$("#incAng").spinner("value",0);"Normal"==this.value?$("#obliDiv").hide():($("#obliDiv").show(),$("#TEpol").prop("checked",!0))});$('input[name="polSel"]').change(function(){});
$("#sThickn").spinner({max:5E3,min:50,step:10,spin:function(a,b){b.value.toFixed(0)},change:function(a,b){}}).val(1E3);$("#cThickn").spinner({max:5E3,min:50,step:10,spin:function(a,b){b.value.toFixed(0)},change:function(a,b){}}).val(1E3);$("#incAng").spinner({max:90,min:0,step:1,spin:function(a,b){b.value.toFixed(0)},change:function(a,b){}}).val(0);$("#SpStart").spinner({max:stack.settings.spStop,min:300,step:1,spin:function(a,b){},change:function(a,b){var c=this.value;$("#spRange1").text(c)},stop:function(a,
b){var c=this.value;$("#spRange1").text(c)}}).val(400);$("#SpStop").spinner({max:5E3,min:stack.settings.spStart,step:1,spin:function(a,b){},change:function(a,b){var c=this.value;$("#spRange2").text(c)},stop:function(a,b){var c=this.value;$("#spRange2").text(c)}}).val(1E3);$('input[name="setUnit"]').change(function(){stack.settings.spUnit=this.value;var a=$("#lblStartUn").text();if(0<a.indexOf("nm"))a=$("#SpStart").spinner("value"),stack.settings.spStart=a.toFixed(0),a=$("#SpStop").spinner("value"),
stack.settings.spStop=a;else if(0<a.indexOf("um"))a=1E3*$("#SpStart").spinner("value"),stack.settings.spStart=a.toFixed(0),a=1E3*$("#SpStop").spinner("value"),stack.settings.spStop=a.toFixed(0);else if(0<a.indexOf("eV")&&0<$("#SpStart").spinner("value")&&0<$("#SpStop").spinner("value"))a=1239.842/$("#SpStart").spinner("value"),stack.settings.spStart=a.toFixed(0),a=1239.842/$("#SpStop").spinner("value"),stack.settings.spStop=a.toFixed(0);else{alert("error in start or stop value!");return}"T"==stack.settings.RorT?
$("#CalcRes").text("Transmittance is graphed on "+stack.settings.spUnit+" axis"):$("#CalcRes").text("Reflectance is graphed on "+stack.settings.spUnit+" axis");setSpinners();$("#spRange1").text(stack.settings.spStart);$("#spRange2").text(stack.settings.spStop)});buildSpArray();createStackTable();$("input[name=graphMode]:radio").change(function(){updRTspArra();updNKspArra();updGraph()});oStackTable.on("dblclick","td:nth-child(2)",function(a){$(this)[0].editing||($(this).editable(function(a,c){return a},
{event:"dblclick.editable",type:"select",onblur:"submit",data:function(){var a;if(1>stack.Materials.length)a="{'':'Empty materials list','-':'Populate it on','--':'Materials Tab'}";else{a="{'':'Select:'";for(var c=0;c<stack.Materials.length;c++)a=a+",'"+stack.Materials[c].Name+"':'"+stack.Materials[c].Name+"'";a+="}"}return a},onsubmit:function(a,c){$(this).find("select")},callback:function(a,c){var b=oStackTable.cell(this)[0][0];stackArr[b.row][b.column]=a;stack.Layers[b.row][b.column]=a;oStackTable.clear();
oStackTable.rows.add(stackArr);oStackTable.draw();updNKspArra();updRTspArra();updGraph()},height:"14px",width:"100%"}),$(this).dblclick())});""!=stack.settings.usedTarg&&$("#stackTargs option[value=targe]");$("#stackTargs").change(function(){var a=$("#stackTargs option:selected").text();0!=$("#stackTargs option").length&&"Select:"!=a&&(stack.settings.usedTarg=a,updTargSpArra(),updGraph())});$("#descStack").change(function(){var a=$("#descStack").val(),a=a.replace(/(^[\"\']+)|([\"\']+$)/g,"");stack.settings.Descriptor=
a});$.editable.addInputType("qumber",{element:function(a,b){var c=$('<input id="arvotus">');c.attr("type","number");c.attr("min","0");c.attr("max","10000");$(this).append(c);c=$('<input type="hidden">');$(this).append(c);return c},submit:function(a,b){var c=$("#arvotus").val();$("input",this).val(c)}});$.editable.addInputType("checkbox",{element:function(a,b){$(this).append('<input type="checkbox"/>');var c=$('<input type="hidden"/>');$(this).append(c);return c},submit:function(a,b){a=$.extend({checkbox:{trueValue:"1",
falseValue:"0"}},a);$(":checkbox",this).is(":checked")?$(":hidden",this).val(a.checkbox.trueValue):$(":hidden",this).val(a.checkbox.falseValue)},content:function(a,b,c){b=$.extend({checkbox:{trueValue:"1",falseValue:"0"}},b);a==b.checkbox.trueValue?$(":checkbox",this).attr("checked","checked"):$(":checkbox",this).removeAttr("checked")}});oStackTable.on("dblclick","td:nth-child(3)",function(a){a=stackArr.length;var b=$(this).parent().index();$(this)[0].editing||0===b||b===a-1||($(this).editable(function(a,
b){return a},{event:"dblclick.editable",type:"qumber",onblur:"submit",submit:"X",cssclass:"x-class",callback:function(a,b){var c=oStackTable.cell(this)[0][0];stackArr[c.row][c.column]=a;stack.Layers[c.row][c.column]=a;stack.Layers[c.row][4]=a;oStackTable.clear();oStackTable.rows.add(stackArr);oStackTable.draw();updNKspArra();updRTspArra();updGraph()},height:"14px"}),$(this).dblclick())});$("#adjustThs").css("border","3px solid red");$("#adjustThs").hide();oStackTable.on("dblclick","td:nth-child(4)",
function(a){a=stackArr.length;var b=$(this).parent().index();$(this)[0].editing||0===b||b===a-1||($(this).editable(function(a,b){return a},{event:"dblclick.editable",type:"checkbox",onblur:"submit",submit:"X",checkbox:{trueValue:"Yes",falseValue:"No"},callback:function(a,b){var c=oStackTable.cell(this)[0][0];stackArr[c.row][c.column]=a;stack.Layers[c.row][c.column]=a;stack.Layers[c.row][4]=stackArr[c.row][2];oStackTable.clear();oStackTable.rows.add(stackArr);oStackTable.draw();for(var c=stackArr.length,
d=!1,e=0;e<c;e++)"Yes"===stackArr[e][3]&&(d=!0);d?$("#adjustThs").show():$("#adjustThs").hide()}}),$(this).dblclick())});oStackTable.on("click","td",function(a){a=stackArr.length;var b=$(this).parent().index();EnDisButt("Disabled","#btnAddFilm");EnDisButt("Disabled","#btnDelFilm");$(this).closest("tr").hasClass("row_selected")?(oStackTable.$("tr").removeClass("row_selected"),EnDisButt("Disabled","#btnAddFilm"),EnDisButt("Disabled","#btnDelFilm")):(oStackTable.$("tr").removeClass("row_selected"),$(this).closest("tr").addClass("row_selected"),
0!==b&&(EnDisButt("Enabled","#btnAddFilm"),EnDisButt("Disabled","#btnDelFilm")),0!==b&&b!==a-1&&(EnDisButt("Enabled","#btnAddFilm"),EnDisButt("Enabled","#btnDelFilm")),updGraph())});$("#btnAddFilm").click(function(){var a,b=stackArr.length;a=d(oStackTable);var c=oStackTable.row($(a).closest("tr")[0]).index();if(0!==a.length&&0!==c){a=[" ","Select material","0","no",0];stackArr.splice(c,0,a);stack.Layers.splice(c,0,a);for(c=1;c<b;c++)stackArr[c][0]="Film#: "+(b-c),stack.Layers[c][0]="Film#: "+(b-c);
oStackTable.clear();oStackTable.rows.add(stackArr);oStackTable.draw()}stackArr.ready=!1});$("#btnDelFilm").click(function(){var a=stackArr.length;EnDisButt("Disabled","#btnDelFilm");var b=d(oStackTable);if(0!==b.length&&2<stackArr.length){b=oStackTable.row($(b).closest("tr")[0]).index();stackArr.splice(b,1);stack.Layers.splice(b,1);for(b=1;b<a-2;b++)stackArr[b][0]="Film#: "+(a-2-b),stack.Layers[b][0]="Film#: "+(a-2-b);oStackTable.clear();oStackTable.rows.add(stackArr);oStackTable.draw();updNKspArra();
updRTspArra();updGraph()}});$("#tuneSpin").spinner({max:100,min:-100,step:.1,spin:function(a,b){},change:function(a,b){stack.settings.tunePrcnt=this.value}}).val(stack.settings.tunePrcnt);$("#repTune").click(function(){stack.settings.tunePrcnt=$("#tuneSpin").val();tuneOneTime()});var k;$("#repTune").mousedown(function(){var a;stack.settings.tunePrcnt=$("#tuneSpin").val();k=setInterval(function(){a=Date.now();tuneOneTime();a=Date.now()-a},500);return!1});$("#repTune").mouseout(function(){clearInterval(k);
return!1});$("#repTune").dblclick(function(){clearInterval(k);tuneOneTime();return!1});$("#repTune").mouseup(function(){clearInterval(k);return!1});$("#reveTune").click(function(){revertTune();$("#adjustThs").hide()});$("#autoTune").click(function(){var a=$(this).children(".ui-button-text","span");a.text("AutoTune"==a.text()?"StopTune":"AutoTune");"StopTune"==a.text()&&"Stop"!=iter1()&&setTimeout(function(a,c){c(a)},10,10,iter2)});createTargEditTable();otargTable.clear();otargTable.rows.add(targArr.slice(1));
otargTable.draw();plotRT(targArr,7);otargTable.on("click contextmenu","td",function(a){EnDisButt("Enabled","#btnDelTargRow");EnDisButt("Enabled","#btnAddTargRow");1!==a.which?(a.preventDefault(),EnDisButt("Disabled","#btnDelTargRow"),EnDisButt("Disabled","#btnAddTargRow"),0!==otargTable.$("tr.row_selected").length&&otargTable.$("tr.row_selected").removeClass("row_selected")):$(this).closest("tr").hasClass("row_selected")?($(this).closest("tr").removeClass("row_selected"),EnDisButt("Disabled","#btnDelTargRow"),
EnDisButt("Disabled","#btnAddTargRow")):(otargTable.$("tr.row_selected").removeClass("row_selected"),$(this).closest("tr").addClass("row_selected"),EnDisButt("Enabled","#btnDelTargRow"),EnDisButt("Enabled","#btnAddTargRow"))});otargTable.on("dblclick","td",function(a){$(this)[0].editing||($(this).editable(function(a,c){return a},{tooltip:"Click to select row, dblclick to edit...",event:"dblclick.editable",onsubmit:function(a,c){var b=$(c).find("input").val();return g(b)},callback:function(a,c){var b=
otargTable.cell(this)[0][0];targArr[b.row+1][b.column]=a;targArr=f(targArr);otargTable.clear();otargTable.rows.add(targArr.slice(1));otargTable.draw();plotRT(targArr,7);$("#ediTarge").val("Unsaved target");$("#descTarge").val("Edited target data")},height:"14px",width:"100%"}),$(this).dblclick())});$("#btnDelTargRow").click(function(){var a=d(otargTable),b=targArr.length;0!==a.length&&1<b?(a=otargTable.row($(a).closest("tr")[0]).index(),targArr.splice(a+1,1),otargTable.clear(),otargTable.row.add(targArr.slice(1)),
otargTable.draw(),plotRT(targArr,7),$("#ediTarge").val("Unsaved target data"),$("#descTarge").val("Edited target data"),EnDisButt("Disabled","#btnUseTarg")):(a=otargTable.row($(a).closest("tr")[0]).index(),alert("Cannot remowe row No: "+a+" !"));EnDisButt("Disabled","#btnDelTargRow");EnDisButt("Disabled","#btnAddTargRow")});$("#btnAddTargRow").click(function(){EnDisButt("Disabled","#btnUseTarg");var a;a=d(otargTable);var b;0!==a.length&&(b=oMatTable.row($(a).closest("tr")[0]).index(),a=[a.find("td:eq(0)").html(),
"0.0"],targArr.splice(b+1,0,a),targArr=f(targArr),otargTable.clear(),otargTable.rows.add(targArr.slice(1)),otargTable.draw(),plotRT(targArr,7),$("#ediTarge").val("Unsaved target data"),$("#descTarge").val("Edited target data"),EnDisButt("Disabled","#btnUseTarg"))});createTargOptsTable();oTargOptTable.on("click","td",function(a){a=oTargOptTable.row($(this).closest("tr")[0]).index();targArr=[];for(var b=stack.Targets[a].Data.length,c=0;c<b;c++){targArr.push([]);for(var d=stack.Targets[a].Data[c].length,
e=0;e<d;e++)targArr[c].push(stack.Targets[a].Data[c][e])}plotRT(targArr,7);$("#descTarge").val(targArr[0][3]?matrlArr[0][3]:"");$("#ediTarge").val(stack.Targets[a].File);otargTable.clear();otargTable.rows.add(targArr.slice(1));otargTable.draw();$("#targEditTabl").find("th:eq(0)").text("Unit ["+targArr[0][0]+"]");$(this).closest("tr").hasClass("row_selected")?(oTargOptTable.$("tr").removeClass("row_selected"),EnDisButt("Disabled","#btnRmvTarg")):(oTargOptTable.$("tr").removeClass("row_selected"),$(this).closest("tr").addClass("row_selected"),
EnDisButt("Enabled","#btnRmvTarg"))});$("#btnUseTarg").click(function(){var a;a=$("#ediTargeLbl").text();var b=a.lastIndexOf("Public");-1<b?a="Publ":(b=a.lastIndexOf("Local"),a=-1<b?"Local":userName);EnDisButt("Disabled","#btnRmvTarg");if(0<$("#ediTarge").val().length){var b=$("#ediTarge").val(),c=menuTitle(b);addTo_specOpts(b,c,a,targArr);a=makeOptsArr(stack.Targets);oTargOptTable.clear();b=a.length;0<b&&(oTargOptTable.rows.add(a),oTargOptTable.draw())}StackTargSelUpd()});$("#btnRmvTarg").click(function(){var a;
EnDisButt("Disabled","#btnRmvTarg");EnDisButt("Disabled","#btnUseTarg");a=d(oTargOptTable);0!==a.length&&0<stack.Targets.length&&(a=oTargOptTable.row($(a).closest("tr")[0]).index(),stack.Targets.splice(a,1),a=makeOptsArr(stack.Targets),oTargOptTable.clear(),0<a.length&&(oTargOptTable.rows.add(a),oTargOptTable.draw()));StackTargSelUpd()});oTargOptTable.on("dblclick","td:nth-child(2)",function(a){$(this)[0].editing||($(this).editable(function(a,c){return a},{tooltip:"to edit dblclick 2:nd col. elsewhere to select",
event:"dblclick.editable",onsubmit:function(a,c){return 0<$(c).find("input").val().length?!0:!1},callback:function(a,c){var b;b=oTargOptTable.cell(this)[0][0];stack.Targets[b.row].Name=a;b=makeOptsArr(stack.Targets);0<b.length&&(oTargOptTable.clear(),oTargOptTable.rows.add(b))},height:"14px",width:"100%"}),$(this).dblclick())});plotNK(matrlArr,8);createMatEditTable();oMatTable.clear();oMatTable.rows.add(matrlArr.slice(1));oMatTable.draw();oMatTable.on("click","td",function(a){$(this).closest("tr").hasClass("row_selected")?
($(this).closest("tr").removeClass("row_selected"),EnDisButt("Disabled","#btnDelMatRow"),EnDisButt("Disabled","#btnAddMatRow")):(oMatTable.$("tr.row_selected").removeClass("row_selected"),$(this).closest("tr").addClass("row_selected"),EnDisButt("Enabled","#btnDelMatRow"),EnDisButt("Enabled","#btnAddMatRow"))});$("#btnOpenTarg, #btnOpenMat, #btnOpenStack").click(function(){var a;$("#openOpti").css("display","none");switch(this.id){case "btnOpenMat":a="Open material file from";break;case "btnOpenTarg":a=
"Open target file from";break;case "btnOpenStack":a="Open stack file from";break;default:alert("unknown file request")}DFmngo.css("display","inline").dialog("option","title",a).dialog("open")});createMatOptsTable();$("#btnUseMat").click(function(){var a;a=$("#ediMaterLbl").text();var b=a.lastIndexOf("Public");-1<b?a="Publ":(b=a.lastIndexOf("Local"),a=-1<b?"Local":userName);EnDisButt("Disabled","#btnRmvMat");if(0<$("#ediMater").val().length){var b=$("#ediMater").val(),c=menuTitle(b);-1<$("#ediMaterLbl").text().indexOf("Local")&&
(a="Local file");addTo_matOpt(b,c,a,matrlArr);a=makeOptsArr(stack.Materials);oMatOptTable.clear();0<a.length&&(oMatOptTable.rows.add(a),oMatOptTable.draw())}});$("#btnReadLMat").click(function(){$("#matLocFiles").focus().click()});oMatOptTable.on("click","td",function(a){a=oMatOptTable.row($(this).closest("tr")[0]).index();matrlArr=[];for(var b=stack.Materials[a].Data.length,c=0;c<b;c++){matrlArr.push([]);for(var d=stack.Materials[a].Data[c].length,e=0;e<d;e++)matrlArr[c].push(stack.Materials[a].Data[c][e])}plotNK(matrlArr,
8);$("#descMater").val(matrlArr[0][3]?matrlArr[0][3]:"");$("#ediMater").val(stack.Materials[a].File);oMatTable.clear();oMatTable.rows.add(matrlArr.slice(1));oMatTable.draw();$("#matEditTabl").find("th:eq(0)").text("Unit ["+matrlArr[0][0]+"]");$(this).closest("tr").hasClass("row_selected")?EnDisButt("Disabled","#btnRmvMat"):EnDisButt("Enabled","#btnRmvMat")});$("#btnRmvMat").click(function(){var a;EnDisButt("Disabled","#btnRmvMat");EnDisButt("Disabled","#btnUseMat");a=d(oMatOptTable);0!==a.length&&
0<stack.Materials.length&&(a=oMatOptTable.row($(a).closest("tr")[0]).index(),stack.Materials.splice(a,1),a=makeOptsArr(stack.Materials),oMatOptTable.clear(),0<a.length&&(oMatOptTable.rows.add(a),oMatOptTable.draw()))});oMatOptTable.on("dblclick","td:nth-child(2)",function(a){EnDisButt("Disabled","#btnRmvMat");$(this)[0].editing||($(this).editable(function(a,c){return a},{tooltip:"Click selects row, dblclick edits Label",event:"dblclick.editable",onsubmit:function(a,c){return 0<$(c).find("input").val().length?
!0:!1},callback:function(a,c){var b;b=oMatOptTable.cell(this)[0][0];stack.Materials[b.row].Name=a;b=makeOptsArr(stack.Materials);0<b.length&&(oMatOptTable.clear(),oMatOptTable.rows.add(b),oMatOptTable.draw())},height:"14px",width:"100%"}),$(this).dblclick())});$("#btnSaveMat, #btnSaveTarg, #btnSaveStack").click(function(){var a,b="";switch(this.id){case "btnSaveMat":a="Save material data to";$("#mongFileDesc").val($("#descMater").val());$("#mongFileDescLbl").text("Material file description:");b="No login"==
userName?"Material files in public directory":"Material files in "+userName+"'s directory";break;case "btnSaveTarg":a="Save target data to";$("#mongFileDesc").val($("#descTarge").val());$("#mongFileDescLbl").text("Target file description:");b="No login"==userName?"Target files in public directory":"Target files in user's directory";break;case "btnSaveStack":a="Save stack data to";$("#mongFileDescLbl").text("Stack file description:");$("#mongFileDesc").val($("#descStack").val());b="No login"==userName?
"Stack files in public directory":"Stack files in user's directory";break;default:alert("No server file access for: undefined")}DFmngo.css("display","inline").dialog("option","title",a).dialog("open");$("#FilTreLege").text(b)});$("#btnDelMatRow").click(function(){var a=d(oMatTable),b=matrlArr.length-1;0!==a.length&&1<b?(a=oMatTable.row($(a).closest("tr")[0]).index(),matrlArr.splice(a+1,1),oMatTable.clear(),oMatTable.rows.add(matrlArr.slice(1)),oMatTable.draw(),$("#matEditTabl").find("th:eq(0)").text("Wavel. ["+
matrlArr[0][0]+"]"),plotNK(matrlArr,8),$("#ediMater").val("Unsaved material"),$("#descMater").val("Edited material data")):(a=oMatTable.row($(a).closest("tr")[0]).index(),alert("Cannot remowe row No:"+a+" !"));EnDisButt("Disabled","#btnDelMatRow");EnDisButt("Disabled","#btnAddMatRow")});$("#btnAddMatRow").click(function(){var a;a=d(oMatTable);EnDisButt("Disabled","#btnUseMat");rowIndex=oMatTable.row($(a).closest("tr")[0]).index();0!==a.length&&(a=[a.find("td:eq(0)").html(),"n","k"],matrlArr.splice(rowIndex+
1,0,a),matrlArr=f(matrlArr),oMatTable.clear(),oMatTable.rows.add(matrlArr.slice(1)),oMatTable.draw(),$("#matEditTabl").find("th:eq(0)").text("Wavel. ["+matrlArr[0][0]+"]"),plotNK(matrlArr,8),$("#ediMater").val("Unsaved material"),$("#descMater").val("Edited material data"))});oMatTable.on("dblclick","td",function(a){$(this)[0].editing||($(this).editable(function(a,c){return a},{tooltip:"Click to select row, dblclick to edit",event:"dblclick.editable",onsubmit:function(a,c){var b=$(c).find("input"),
d=b.val();if(g(d))return!0;b.css("background-color","#c00").css("color","#fff");return!1},callback:function(a,c){var b=oMatTable.cell(this)[0][0];matrlArr[b.row+1][b.column]=a;matrlArr=f(matrlArr);oMatTable.clear();oMatTable.rows.add(matrlArr.slice(1));oMatTable.draw();$("#matEditTabl").find("th:eq(0)").text("Wavel. ["+matrlArr[0][0]+"]");plotNK(matrlArr,8);$("#ediMater").val("Unsaved material");$("#descMater").val("Edited material data")},height:"14px",width:"100%"}),$(this).dblclick())});oMatOptTable.on("click contextmenu",
"td",function(a){1!==a.which?(a.preventDefault(),0!==oMatOptTable.$("tr.row_selected").length&&oMatOptTable.$("tr.row_selected").removeClass("row_selected")):$(this).closest("tr").hasClass("row_selected")?($(this).closest("tr").removeClass("row_selected"),$(".ui-dialog-buttonpane button:contains('Delete Selected')").attr("disabled",!0).addClass("ui-state-disabled"),$(".ui-dialog-buttonpane button:contains('Update Label')").attr("disabled",!0).addClass("ui-state-disabled")):(oMatOptTable.$("tr.row_selected").removeClass("row_selected"),
$(this).closest("tr").addClass("row_selected"),$(".ui-dialog-buttonpane button:contains('Delete Selected')").attr("disabled",!1).removeClass("ui-state-disabled"),$(".ui-dialog-buttonpane button:contains('Update Label')").attr("disabled",!1).removeClass("ui-state-disabled"))});$(window).resize(function(){plotRT(targArr,7);plotNK(matrlArr,8)});$("#matLocFiles, #targLocFiles, #stackLocFiles").on("change",function(){var a="";switch(this.id){case "matLocFiles":a=$("#matLocFiles").get(0).files[0];if(!a)return;
$("#ediMaterLbl").text("Local File: ");$("#ediMater").val(this.value);break;case "targLocFiles":a=$("#targLocFiles").get(0).files[0];if(!a)return;$("#ediTarge").val(a.name);$("#ediTargeLbl").text("Local File:");break;case "stackLocFiles":a=$("#stackLocFiles").get(0).files[0];if(!a)return;$("#ediStack").val(a.name);$("#ediStackLbl").text("Local File:")}ReadLocFle(a,gotTextFile)})});
function tuneOneTime(){for(var d=stackArr.length,g=stack.settings.tunePrcnt,f=0;f<d;f++)"Yes"===stackArr[f][3]&&(stackArr[f][2]*=1+g/100,stackArr[f][2]=Math.round(1E3*stackArr[f][2])/1E3);oStackTable.clear();oStackTable.rows.add(stackArr);oStackTable.draw();d=evalDif();$("#tuneVar").val(d.difVar);$("#tuneDif").val(d.difAve);updRTspArra();updGraph()}
function StackTargSelUpd(){var d=$("#stackTargs");d.empty();d.append('<option selected="selected" value="whatever">List is empty</option>');for(var g=stack.Targets.length,f,e=0;e<g;e++)0==e&&(d.empty(),d.append($("<option></option>").val(0).html("Select:"))),d.append($("<option>",{value:e+1,text:stack.Targets[e].Name})),stack.settings.usedTarg==stack.Targets[e].Name&&(f=e+1);""!=stack.settings.usedTarg&&($("#stackTargs option").prop("selected",!1),$('#stackTargs option[value="'+f+'"]').prop("selected",
"selected"))}function addTo_specOpts(d,g,f,e){stack.Targets.push({File:d,Name:g,Owner:f,Data:e})}function addTo_matOpt(d,g,f,e){stack.Materials.push({File:d,Name:g,Owner:f,Data:e})}
function setSpinners(){switch(stack.settings.spUnit){case "nm":$("#SpStart").spinner({max:stack.settings.spStop,min:300,step:1}).val(stack.settings.spStart);$("#SpStop").spinner({max:5E3,min:stack.settings.spStart,step:1}).val(stack.settings.spStop);$("#lblStartUn").text("[ nm ]");$("#lblStopUn").text("[ nm ]");break;case "um":$("#SpStart").spinner({max:stack.settings.spStop/1E3,min:.3,step:.001}).val(stack.settings.spStart/1E3);$("#SpStop").spinner({max:5,min:stack.settings.spStart/1E3,step:.001}).val(stack.settings.spStop/
1E3);$("#lblStartUn").text("[ um ]");$("#lblStopUn").text("[ um ]");break;case "eV":var d=(1239.842/stack.settings.spStart).toFixed(4),g=(1239.842/stack.settings.spStop).toFixed(4),f=((d-g)/600).toFixed(4);$("#SpStart").spinner({step:f,max:(1239.842/300).toFixed(4),min:g}).val(d);$("#SpStop").spinner({step:f,max:d,min:(1239.8/5E3).toFixed(4)}).val(g);$("#lblStartUn").text("[ eV ]");$("#lblStopUn").text("[ eV ]");break;default:$("#SpStart").spinner({step:1,max:stack.settings.spStop,min:300}).val(stack.settings.spStart),
$("#SpStop").spinner({step:1,max:5E3,min:stack.settings.spStart}).val(stack.settings.spStop),$("#lblStartUn").text("[ nm ]"),$("#lblStopUn").text("[ nm ]")}}function EnDisButt(d,g){"Disabled"==d?($(g).disabled=!0,$(g).attr("disabled","disabled"),$(g).addClass("ui-button-disabled ui-state-disabled")):($(g).disabled=!1,$(g).removeAttr("disabled"),$(g).removeClass("ui-button-disabled ui-state-disabled"))}
function reflCalc(d,g){var f=d.sub(g),e=d.add(g),f=f.divBy(e);return(100*f.mult(Complex.conj(f))).abs()}function complN(d,g){return Math.Complex(d,g)}
function matrixMult(){for(var d=Math.Complex(stack.settings.angle*Math.PI/180,0),g=stackArr.length,f=spArra.length,e=1;e<f;e++){for(var h=spArra[e][0],k=Math.Complex(stackArr[0][4][e],-stackArr[0][5][e]),a="TE"==stack.settings.polaris?k.mul(d.cos()):k.div(d.cos()),b=Math.Complex(stackArr[g-1][4][e],-stackArr[g-1][5][e]),c=d.sin().mul(k.div(b)).asin(),b="TE"==stack.settings.polaris?b.mul(c.cos()):b.div(c.cos()),c=Math.Complex(1,0),p=b,l=g-2;0<l&&stackArr.ready;l--)var m=Math.Complex(stackArr[l][4][e],
-stackArr[l][5][e]),q=d.sin().mul(k.div(m)).asin().cos(),n="TE"==stack.settings.polaris?m.mul(q):m.div(q),r=0<h?Math.Complex(2*Math.PI*stackArr[l][2]/h,0).mul(m.mul(q)):NaN,m=r.cos(),q=Math.Complex(0,1).mul(r.sin().div(n)),n=Math.Complex(0,1).mul(n.mul(r.sin())),r=m,m=m.mul(c).add(q.mul(p)),p=n.mul(c).add(r.mul(p)),c=m;h=0<c.abs()?p.div(c):NaN;h=0<a.add(h).abs()?a.sub(h).div(a.add(h)).abs():NaN;l=p.con();l=l.mul(c).re;n=stackArr[g-1][4][e];l=(1-h*h)*n/l;"R"==stack.settings.RorT?stack.settings.backR||
stack.settings.frontR?stack.settings.backR?(a=a.sub(b).div(a.add(b)).abs(),k=4*Math.PI/spArra[e][0]*b.im,b=1E3*$("#sThickn").spinner("value"),a*=a,spArra[e][1]=100*(h*h+Math.exp(2*k*b)*a*l*l/(1-h*h*a*Math.exp(2*k*b)))):(b=Math.Complex(1,0),k=d.sin().mul(k.div(b)).asin(),k=k.cos(),c=a.sub(k).div(a.add(k)).abs(),k=4*Math.PI/spArra[e][0]*a.im,b=1E3*$("#cThickn").spinner("value"),c*=c,a=c+Math.exp(2*k*b)*(1-c)*(1-c)*h*h/(1-Math.exp(2*k*b)*h*h*c),spArra[e][1]=100*a):spArra[e][1]=h*h*100:(l=p.con(),l=l.mul(c).re,
n=stackArr[g-1][4][e],l=(1-h*h)*n/l,stack.settings.backR||stack.settings.frontR?(stack.settings.backR?(a=a.sub(b).div(a.add(b)).abs(),k=4*Math.PI/spArra[e][0]*b.im,b=stack.settings.SubstrD,a*=a,a=Math.exp(k*b)*(1-a)*l/(1-Math.exp(2*k*b)*h*h*a)):(b=Math.Complex(1,0),k=d.sin().mul(k.div(b)).asin(),k=k.cos(),c=a.sub(k).div(a.add(k)).abs(),k=4*Math.PI/spArra[e][0]*a.im,b=stack.settings.CoverD,c*=c,a=Math.exp(k*b)*(1-c)*l/(1-Math.exp(2*k*b)*h*h*c)),spArra[e][1]=100*a):spArra[e][1]=100*l)}};
