doctype html
html
  head
    title= title
  block scripts
    meta(name="viewport" content="width=device-width, initial-scale=1.0")
    link(rel='stylesheet', href='/bower_components/bootstrap/dist/css/bootstrap.min.css')
    //script(src='https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js')
    script(src='/bower_components/jquery/dist/jquery.min.js')
    script(src='/bower_components/bootstrap/dist/js/bootstrap.min.js')
    script(src='/bower_components/jquery-validation/dist/jquery.validate.js')
    script(src='/bower_components/jqnotifybar/jquery.notifyBar.js')
    link(rel='stylesheet', href='/bower_components/jqnotifybar/css/jquery.notifyBar.css')
    link(rel='stylesheet', href='/bower_components/jquery-ui/themes/start/jquery-ui.min.css')
  body
    //-.navbar.navbar-static-top(role='navigation')
    .navbar.navbar-inverse.navbar-static-top(role='navigation')
      .container
        .navbar-header
          button.navbar-toggle(type='button', data-toggle='collapse', data-target='.navbar-collapse')
            span.sr-only Toggle navigation
            //-tehdään neljä päällekkäistä viivaa kun nav-bar menee liian kapeaksi
            span.icon-bar
            span.icon-bar
            span.icon-bar
            span.icon-bar
          //-a.navbar-brand(href='/') Project name
        .collapse.navbar-collapse
          ul.nav.navbar-nav  
            li(id='hoiMenu').dropdown
              a(href='#' class='dropdown-toggle' data-toggle='dropdown') Services
                b.caret
              ul.dropdown-menu
                li
                  a(href='/') Home
                  //-to show the username:
                  //-if user
                      use: #{user}
                  //-if user!=null && user!='No login'
                li
                  a(id='lokoutti', href='/Logout') Logout
                li
                  a(id='pwdchangi', href='/pwdEdit') Change pwd
                  //-else
                li
                  a(id='loginni', href='/login') Login
                li
                  a(id='signuppi', href='/signup') Signup
                if user
                  if user.username=='Publ'
                    li
                      a(id='admin', href='/admin') Admin
            li.dropdown
              a(href='#' class='dropdown-toggle' data-toggle='dropdown') Projects
                b.caret 
              ul.dropdown-menu  
                li
                  a(href='/refletrans') Reflectance and transmittance of thin films
                li
                  a(href='/broadmod') Spectral broadening in light emitting diodes (under construction)
                //-li
                  a(href='/GasFlo') Gas flow in circular pipes (under construction)
                //-li
                  a(href='/tabX') Testing document ready function
            li.dropdown
              a(href='#' class='dropdown-toggle' data-toggle='dropdown') Info
                b.caret
              ul.dropdown-menu
                li
                  a(href='/contrbs') Credits and acknowledgements
                li
                  a(href='/custmsgs') Comments and Messages
                li
                  a(href='/aboutti') About this site
            li
              a(href='#' id='userN' class='dropdown-toggle' data-toggle='dropdown') User:
                b.caret
              ul.dropdown-menu
                li
                  a(id='lokoutti2', href='/Logout') Logout
          //-a.navbar-brand(href='/') Projects
        //-gets messages from req.flash set in app.js
    if messages
      .container
        if messages && messages.error
          .alert.alert-danger
            div= messages.error
        if messages && messages.info
          .alert.alert-info
            div= messages.info
        if messages && messages.success
          .alert.alert-success
            div= messages.success
        block content
          //-block content määritellään index.pug, login.pug, signup.pug, pwdEdit.pug, forgot.pug
          //-sivuilta joille nämä asetukset periytyvät

  script(type='text/javascript').
    var tokenee = window.sessionStorage.getItem('RTFtoken');
    var userLuser = window.sessionStorage.getItem('RTFuser');
    if (userLuser==null||userLuser=='No login'||userLuser=='No Login'){
      $('#userN').text('No login');
      $("#lokoutti2").css('display','none');
    }else{
      $('#userN').text('User: '+ userLuser);
      $("#lokoutti2").css('display','inline');
    }
    $('#hoiMenu').click(function () {
      var tokenee = window.sessionStorage.getItem('RTFtoken');
      var userLuser=window.sessionStorage.getItem('RTFuser');
      //as default assume no login:
      //$('#userN').text(userLuser);
      $('#lokoutti').hide();
      $('#pwdchangi').hide();
      $('#loginni').show();
      $('#signuppi').show();
      if (userLuser != null && userLuser != 'No login') {
        //user has logged in but is that still valid?
        var loginStatus = $.post('/checklogin', {
          userNme: userLuser,
          rtftoken: tokenee
        }).done(function (data, status, xhr) {
          if (data) {
            console.log('checklogin: ', data);
            if (data.token == 'valid') {//login is ok, set menus:
              $('#lokoutti').show();
              $('#pwdchangi').show();
              $('#loginni').hide();
              $('#signuppi').hide();
            } else {//invalid token set menus:
              window.sessionStorage.setItem('RTFuser', 'No login');
              window.sessionStorage.setItem('RTFtoken', null);
            }
          }
        })
      }
    });
    $('#lokoutti, #lokoutti2').click(function(){
      window.sessionStorage.setItem('RTFuser', 'No login');
      window.sessionStorage.setItem('RTFtoken', null);
      $('#userN').text('No login');
      $("#lokoutti2").css('display','none');
      //class="disabled"
    });